import gym.spaces
import random
import torch
import numpy as np
from collections import deque
import matplotlib.pyplot as plt
from interval import Interval
from env import Osillator

env = Osillator()

import os
import sys

module_path = os.path.abspath(os.path.join('../..'))
if module_path not in sys.path:
	sys.path.append(module_path)

from Agent import Agent

device = torch.device("cuda:0" if torch.cuda.is_available() else "cpu")

random_seed = int(sys.argv[2])

from itertools import count
import time

agent = Agent(state_size=2, action_size=1, random_seed=random_seed)
pathTxt = './log.txt'

def save_model(seed):
	print("Model Save...")
	torch.save(agent.actor_local.state_dict(), 'actor_new.pth')

def ddpg(n_episodes=10000, max_t=200, print_every=1, save_every=100):
	scores_deque = deque(maxlen=100)
	scores = []
	
	for i_episode in range(1, n_episodes+1):
		state = env.reset()
		agent.reset()
		score = 0
		timestep = time.time()
		for t in range(max_t):
			action = agent.act(state)[0]
			next_state, reward, done = env.step(action)
			agent.step(state, action, reward, next_state, done, t)
			score += reward
			state = next_state            
			if done:
				break 
				
		scores_deque.append(score)
		scores.append(score)
		score_average = np.mean(scores_deque)
		
		if i_episode % save_every == 0:
			save_model(random_seed)
		
		if i_episode % print_every == 0:
			print('\rEpisode {}, Average Score: {:.2f}, Current Score:{:.2f}, Max: {:.2f}, Min: {:.2f}, Epsilon: {:.2f}, Momery:{:.1f}'\
				  .format(i_episode, score_average,  scores[-1], np.max(scores), np.min(scores), agent.epsilon, len(agent.memory)), end="\n")     
					
	return scores

# scores = ddpg()
# assert False

def model_test(agent, filename, state_list, renew, fig):
	agent.actor_local.load_state_dict(torch.load(filename))
	dis = []
	velocity = []
	accleration = []
	fuel_list = []
	bp0 = []
	bp1=[]
	bp2=[]
	if renew:
		state_list = []
	for ep in range(1):
		total_reward = 0
		fuel = 0
		if renew:
			state = env.reset(-1.2, -1.5)
			state_list.append(state)
		else: 
			state = env.reset(state_list[ep][0], state_list[ep][1])
		# print(state)
		for t in range(201):
			action = agent.act(state, add_noise=False)[0]
			action_partition = BP2800partition(state)
			action_single_d3 = BP2800single_d3(state)
			action_single_d7 = BP2800single_d7(state)
			fuel += 20 * abs(action)
			next_state, reward, done = env.step(action)
			if ep == 0:
				dis.append(state[0])
				velocity.append(state[1])
				accleration.append(action*20)
				bp0.append(action_partition*20)
				bp1.append(action_single_d3*20)
				bp2.append(action_single_d7*20)
				# print(t, state, next_state, action_bp*20, abs(action-action_bp), done)
				# assert False
			total_reward += reward
			state = next_state
			if done:
				break
		if t >= 190:
			fuel_list.append(fuel) 
		print(ep, fuel)
	# fig = plt.figure(fig)
	# ax1 = fig.add_subplot(131)
	# ax2 = fig.add_subplot(132)
	# ax3 = fig.add_subplot(133)

	# ax1.title.set_text('x0')
	# ax2.title.set_text('x1')
	# ax3.title.set_text('u')

	# plt.subplot(1, 3, 1)
	# plt.plot(dis)
	# plt.subplot(1, 3, 2)
	# plt.plot(velocity, color='y')
	# plt.subplot(1, 3, 3)
	# plt.plot(accleration, color='g')
	# plt.savefig(filename+'_0.05.png')
	
	# plt.figure(2)
	plt.plot(accleration, label='NN')
	plt.plot(bp0, label='partition')
	plt.plot(bp1, label='single,d=3')
	plt.plot(bp2, label='single,d=7')
	plt.legend()
	plt.savefig('comparison.png')
	# np.save('./plot/rl1_ori.npy', np.array(accleration))
	# np.save('./plot/rl1_bp.npy', np.array(bp))
	# plt.plot(dis, velocity)
	# plt.savefig('test.png')
	return state_list, fuel_list

# actor_2800
def bp2800(state):
	x0 = state[0]
	x1 = state[1]
	if x0 <= -1: #[5, 5] err 0.04
		y = 0.211821732936618*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)**5*(0.5*x1 + 1)**4 + 0.959908790693242*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0)*(0.5*x1 + 1)**4 + 6.63793644726041*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2*(0.5*x1 + 1)**4 + 11.9395748199457*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3*(0.5*x1 + 1)**4 + 10.7533294573267*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4*(0.5*x1 + 1)**4 + 3.25080397572655*(0.5 - 0.25*x1)*(0.5*x0 + 1)**5*(0.5*x1 + 1)**4 + 0.0306536956322729*(1 - 0.5*x1)**5*(-1.0*x0 - 1.0)**5 + 0.154858741541887*(1 - 0.5*x1)**5*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0) + 1.23846788246481*(1 - 0.5*x1)**5*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2 + 2.47066788696962*(1 - 0.5*x1)**5*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3 + 2.45625993748153*(1 - 0.5*x1)**5*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4 + 0.973505594560476*(1 - 0.5*x1)**5*(0.5*x0 + 1)**5 + 0.305577036942436*(1 - 0.5*x1)**4*(-1.0*x0 - 1.0)**5*(0.25*x1 + 0.5) + 1.5269461873855*(1 - 0.5*x1)**4*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0)*(0.25*x1 + 0.5) + 12.2078561507279*(1 - 0.5*x1)**4*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2*(0.25*x1 + 0.5) + 24.2630884905838*(1 - 0.5*x1)**4*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3*(0.25*x1 + 0.5) + 23.887545069846*(1 - 0.5*x1)**4*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4*(0.25*x1 + 0.5) + 9.33084678866096*(1 - 0.5*x1)**4*(0.5*x0 + 1)**5*(0.25*x1 + 0.5) + 0.294989516671095*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)**5*(0.5*x1 + 1)**2 + 1.47261431391297*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0)*(0.5*x1 + 1)**2 + 11.7065690744104*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2*(0.5*x1 + 1)**2 + 23.06620356791*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3*(0.5*x1 + 1)**2 + 22.2289078369071*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4*(0.5*x1 + 1)**2 + 8.36116998031383*(1 - 0.5*x1)**3*(0.5*x0 + 1)**5*(0.5*x1 + 1)**2 + 0.269340793311771*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)**5*(0.5*x1 + 1)**3 + 1.3347077780415*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0)*(0.5*x1 + 1)**3 + 10.2996929290831*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2*(0.5*x1 + 1)**3 + 19.7045696176771*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3*(0.5*x1 + 1)**3 + 18.4296531055796*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4*(0.5*x1 + 1)**3 + 6.25830980359812*(1 - 0.5*x1)**2*(0.5*x0 + 1)**5*(0.5*x1 + 1)**3 + 0.00865801572726102*(-1.0*x0 - 1.0)**5*(0.5*x1 + 1)**5 + 0.0342142310834218*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0)*(0.5*x1 + 1)**5 + 0.19911381525201*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2*(0.5*x1 + 1)**5 + 0.246059062772716*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3*(0.5*x1 + 1)**5 - 0.466362778886606*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4*(0.5*x1 + 1)**5 - 0.29074258298544*(0.5*x0 + 1)**5*(0.5*x1 + 1)**5
	
	elif -1 < x0 and x0 <= 1:#[5, 5] err 0.08
		y = -0.0809624219902675*(0.5 - 0.5*x0)*(0.5 - 0.25*x1)*(x0 + 1)**4*(0.5*x1 + 1)**4 + 0.00513080833479682*(0.5 - 0.5*x0)*(1 - 0.5*x1)**5*(x0 + 1)**4 + 0.00451787459827624*(0.5 - 0.5*x0)*(1 - 0.5*x1)**4*(x0 + 1)**4*(0.25*x1 + 0.5) - 0.0478292454314562*(0.5 - 0.5*x0)*(1 - 0.5*x1)**3*(x0 + 1)**4*(0.5*x1 + 1)**2 - 0.06446580878895*(0.5 - 0.5*x0)*(1 - 0.5*x1)**2*(x0 + 1)**4*(0.5*x1 + 1)**3 - 0.00896639486320906*(0.5 - 0.5*x0)*(x0 + 1)**4*(0.5*x1 + 1)**5 + 0.00317461325754546*(0.5 - 0.25*x1)*(1 - x0)**5*(0.5*x1 + 1)**4 - 0.0199202956984846*(0.5 - 0.25*x1)*(1 - x0)**4*(0.5*x0 + 0.5)*(0.5*x1 + 1)**4 - 0.0578784909011965*(0.5 - 0.25*x1)*(1 - x0)**3*(x0 + 1)**2*(0.5*x1 + 1)**4 - 0.0718352248527857*(0.5 - 0.25*x1)*(1 - x0)**2*(x0 + 1)**3*(0.5*x1 + 1)**4 - 0.00870649498364516*(0.5 - 0.25*x1)*(x0 + 1)**5*(0.5*x1 + 1)**4 + 0.000950689057187965*(1 - x0)**5*(1 - 0.5*x1)**5 + 0.00911215506705172*(1 - x0)**5*(1 - 0.5*x1)**4*(0.25*x1 + 0.5) + 0.00816520505890022*(1 - x0)**5*(1 - 0.5*x1)**3*(0.5*x1 + 1)**2 + 0.00611163066757629*(1 - x0)**5*(1 - 0.5*x1)**2*(0.5*x1 + 1)**3 - 0.000283928303696719*(1 - x0)**5*(0.5*x1 + 1)**5 + 0.00917713372561705*(1 - x0)**4*(1 - 0.5*x1)**5*(0.5*x0 + 0.5) + 0.0831711990344066*(1 - x0)**4*(1 - 0.5*x1)**4*(0.5*x0 + 0.5)*(0.25*x1 + 0.5) + 0.0642212688400609*(1 - x0)**4*(1 - 0.5*x1)**3*(0.5*x0 + 0.5)*(0.5*x1 + 1)**2 + 0.0297852457358305*(1 - x0)**4*(1 - 0.5*x1)**2*(0.5*x0 + 0.5)*(0.5*x1 + 1)**3 - 0.00654256308525845*(1 - x0)**4*(0.5*x0 + 0.5)*(0.5*x1 + 1)**5 + 0.0084556681798659*(1 - x0)**3*(1 - 0.5*x1)**5*(x0 + 1)**2 + 0.0671131439338384*(1 - x0)**3*(1 - 0.5*x1)**4*(x0 + 1)**2*(0.25*x1 + 0.5) + 0.0344934169997227*(1 - x0)**3*(1 - 0.5*x1)**3*(x0 + 1)**2*(0.5*x1 + 1)**2 - 0.0116536440131276*(1 - x0)**3*(1 - 0.5*x1)**2*(x0 + 1)**2*(0.5*x1 + 1)**3 - 0.00777690946312848*(1 - x0)**3*(x0 + 1)**2*(0.5*x1 + 1)**5 + 0.00697979388703993*(1 - x0)**2*(1 - 0.5*x1)**5*(x0 + 1)**3 + 0.0390252429140773*(1 - x0)**2*(1 - 0.5*x1)**4*(x0 + 1)**3*(0.25*x1 + 0.5) - 0.00491767007931407*(1 - x0)**2*(1 - 0.5*x1)**3*(x0 + 1)**3*(0.5*x1 + 1)**2 - 0.0487869035430216*(1 - x0)**2*(1 - 0.5*x1)**2*(x0 + 1)**3*(0.5*x1 + 1)**3 - 0.00849559611013143*(1 - x0)**2*(x0 + 1)**3*(0.5*x1 + 1)**5 + 0.000282842138809236*(1 - 0.5*x1)**5*(x0 + 1)**5 - 0.000973445487963213*(1 - 0.5*x1)**4*(x0 + 1)**5*(0.25*x1 + 0.5) - 0.00325141689518627*(1 - 0.5*x1)**3*(x0 + 1)**5*(0.5*x1 + 1)**2 - 0.0070719621282724*(1 - 0.5*x1)**2*(x0 + 1)**5*(0.5*x1 + 1)**3 - 0.000926743018239576*(x0 + 1)**5*(0.5*x1 + 1)**5
	
	elif 1 < x0: #[5, 5] err 0.067
		y = -8.91545086325264*(0.5 - 0.25*x1)*(1 - 0.5*x0)**5*(0.5*x1 + 1)**4 - 22.0868555158589*(0.5 - 0.25*x1)*(1 - 0.5*x0)**4*(1.0*x0 - 1.0)*(0.5*x1 + 1)**4 - 20.890163756636*(0.5 - 0.25*x1)*(1 - 0.5*x0)**3*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**4 - 10.3292448827067*(0.5 - 0.25*x1)*(1 - 0.5*x0)**2*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**4 - 1.317290153983*(0.5 - 0.25*x1)*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4*(0.5*x1 + 1)**4 - 0.268220567595893*(0.5 - 0.25*x1)*(1.0*x0 - 1.0)**5*(0.5*x1 + 1)**4 + 0.289630350140657*(1 - 0.5*x0)**5*(1 - 0.5*x1)**5 - 0.99680817967433*(1 - 0.5*x0)**5*(1 - 0.5*x1)**4*(0.25*x1 + 0.5) - 3.32945090067074*(1 - 0.5*x0)**5*(1 - 0.5*x1)**3*(0.5*x1 + 1)**2 - 7.24168921935094*(1 - 0.5*x0)**5*(1 - 0.5*x1)**2*(0.5*x1 + 1)**3 - 0.948984850677326*(1 - 0.5*x0)**5*(0.5*x1 + 1)**5 + 0.648663160221596*(1 - 0.5*x0)**4*(1 - 0.5*x1)**5*(1.0*x0 - 1.0) - 4.8322330102515*(1 - 0.5*x0)**4*(1 - 0.5*x1)**4*(1.0*x0 - 1.0)*(0.25*x1 + 0.5) - 9.25253043161326*(1 - 0.5*x0)**4*(1 - 0.5*x1)**3*(1.0*x0 - 1.0)*(0.5*x1 + 1)**2 - 15.5981696127122*(1 - 0.5*x0)**4*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)*(0.5*x1 + 1)**3 - 2.39955029914451*(1 - 0.5*x0)**4*(1.0*x0 - 1.0)*(0.5*x1 + 1)**5 + 0.427608788497068*(1 - 0.5*x0)**3*(1 - 0.5*x1)**5*(1.0*x0 - 1.0)**2 - 7.08884971005153*(1 - 0.5*x0)**3*(1 - 0.5*x1)**4*(1.0*x0 - 1.0)**2*(0.25*x1 + 0.5) - 10.1527453818192*(1 - 0.5*x0)**3*(1 - 0.5*x1)**3*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**2 - 16.2276830191103*(1 - 0.5*x0)**3*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**3 - 2.38316769982012*(1 - 0.5*x0)**3*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**5 + 0.0960633023731191*(1 - 0.5*x0)**2*(1 - 0.5*x1)**5*(1.0*x0 - 1.0)**3 - 4.62932863294883*(1 - 0.5*x0)**2*(1 - 0.5*x1)**4*(1.0*x0 - 1.0)**3*(0.25*x1 + 0.5) - 5.59221537306243*(1 - 0.5*x0)**2*(1 - 0.5*x1)**3*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**2 - 8.49889765795677*(1 - 0.5*x0)**2*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**3 - 1.16631317638001*(1 - 0.5*x0)**2*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**5 - 0.00292723285211354*(1 - 0.5*x1)**5*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4 - 0.00439528708646694*(1 - 0.5*x1)**5*(1.0*x0 - 1.0)**5 - 0.561338809803623*(1 - 0.5*x1)**4*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4*(0.25*x1 + 0.5) - 0.108770310949567*(1 - 0.5*x1)**4*(1.0*x0 - 1.0)**5*(0.25*x1 + 0.5) - 0.766279733394449*(1 - 0.5*x1)**3*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4*(0.5*x1 + 1)**2 - 0.165998216073949*(1 - 0.5*x1)**3*(1.0*x0 - 1.0)**5*(0.5*x1 + 1)**2 - 1.10701569474587*(1 - 0.5*x1)**2*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4*(0.5*x1 + 1)**3 - 0.229662300562643*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)**5*(0.5*x1 + 1)**3 - 0.143512323014739*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4*(0.5*x1 + 1)**5 - 0.0289589629734347*(1.0*x0 - 1.0)**5*(0.5*x1 + 1)**5
	else:
		raise ValueError('undefined section')
	return y

def BP2800partition(state):
	x0 = state[0]
	x1 = state[1]
	if x0 <= -1: #[3, 3] err 0.042
		y = 0.61159439199849*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)**3*(0.5*x1 + 1)**2 + 1.73517165455643*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)**2*(1.0*x0 + 2.0)*(0.5*x1 + 1)**2 + 6.23129153386817*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**2*(0.5*x1 + 1)**2 + 3.12143912012917*(0.5 - 0.25*x1)*(0.5*x0 + 1)**3*(0.5*x1 + 1)**2 + 0.122614782529091*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)**3 + 0.371600451218002*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)**2*(1.0*x0 + 2.0) + 1.48011625420776*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**2 + 0.973505594560476*(1 - 0.5*x1)**3*(0.5*x0 + 1)**3 + 0.719098914413499*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)**3*(0.25*x1 + 0.5) + 2.15311068910975*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)**2*(1.0*x0 + 2.0)*(0.25*x1 + 0.5) + 8.43596116295065*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**2*(0.25*x1 + 0.5) + 5.26665405483538*(1 - 0.5*x1)**2*(0.5*x0 + 1)**3*(0.25*x1 + 0.5) + 0.0346320629090441*(-1.0*x0 - 1.0)**3*(0.5*x1 + 1)**3 + 0.0672514728144303*(-1.0*x0 - 1.0)**2*(1.0*x0 + 2.0)*(0.5*x1 + 1)**3 - 0.0273728164624779*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**2*(0.5*x1 + 1)**3 - 0.29074258298544*(0.5*x0 + 1)**3*(0.5*x1 + 1)**3
	elif -1 < x0 and x0 <= 1:#[3, 3] err 0.1
		y = -0.360892122588973*(0.5 - 0.5*x0)*(0.5 - 0.25*x1)*(x0 + 1)**2*(0.5*x1 + 1)**2 + 0.0599323714233429*(0.5 - 0.5*x0)*(1 - 0.5*x1)**3*(x0 + 1)**2 - 0.0182024093767358*(0.5 - 0.5*x0)*(1 - 0.5*x1)**2*(x0 + 1)**2*(0.25*x1 + 0.5) - 0.0832879230495304*(0.5 - 0.5*x0)*(x0 + 1)**2*(0.5*x1 + 1)**3 + 0.0487724862520183*(0.5 - 0.25*x1)*(1 - x0)**3*(0.5*x1 + 1)**2 - 0.0831418106530142*(0.5 - 0.25*x1)*(1 - x0)**2*(0.5*x0 + 0.5)*(0.5*x1 + 1)**2 - 0.0762356349110361*(0.5 - 0.25*x1)*(x0 + 1)**3*(0.5*x1 + 1)**2 + 0.0152110249150074*(1 - x0)**3*(1 - 0.5*x1)**3 + 0.0822914696068028*(1 - x0)**3*(1 - 0.5*x1)**2*(0.25*x1 + 0.5) - 0.0045428528591475*(1 - x0)**3*(0.5*x1 + 1)**3 + 0.084084306870306*(1 - x0)**2*(1 - 0.5*x1)**3*(0.5*x0 + 0.5) + 0.327868908067144*(1 - x0)**2*(1 - 0.5*x1)**2*(0.5*x0 + 0.5)*(0.25*x1 + 0.5) - 0.071678903908279*(1 - x0)**2*(0.5*x0 + 0.5)*(0.5*x1 + 1)**3 + 0.00452547422094777*(1 - 0.5*x1)**3*(x0 + 1)**3 - 0.0317143356111202*(1 - 0.5*x1)**2*(x0 + 1)**3*(0.25*x1 + 0.5) - 0.0148278882918332*(x0 + 1)**3*(0.5*x1 + 1)**3
	elif 1 < x0: #[3,3] err 0.077
		y = -4.87908063430631*(0.5 - 0.25*x1)*(1 - 0.5*x0)**3*(0.5*x1 + 1)**2 - 6.31785216797514*(0.5 - 0.25*x1)*(1 - 0.5*x0)**2*(1.0*x0 - 1.0)*(0.5*x1 + 1)**2 - 1.67781996174792*(0.5 - 0.25*x1)*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**2 - 0.587860691910905*(0.5 - 0.25*x1)*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**2 + 0.289630350140657*(1 - 0.5*x0)**3*(1 - 0.5*x1)**3 - 2.02971747911169*(1 - 0.5*x0)**3*(1 - 0.5*x1)**2*(0.25*x1 + 0.5) - 0.948984850677326*(1 - 0.5*x0)**3*(0.5*x1 + 1)**3 + 0.302766414849052*(1 - 0.5*x0)**2*(1 - 0.5*x1)**3*(1.0*x0 - 1.0) - 2.93513417435488*(1 - 0.5*x0)**2*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)*(0.25*x1 + 0.5) - 1.43786369757999*(1 - 0.5*x0)**2*(1.0*x0 - 1.0)*(0.5*x1 + 1)**3 + 0.0168971088215223*(1 - 0.5*x1)**3*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**2 - 0.0175811483458678*(1 - 0.5*x1)**3*(1.0*x0 - 1.0)**3 - 0.872457340359778*(1 - 0.5*x1)**2*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**2*(0.25*x1 + 0.5) - 0.334581808502988*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)**3*(0.25*x1 + 0.5) - 0.34672371421563*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**3 - 0.115835851893739*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**3
	else:
		raise ValueError('undefine section')
	return y

def BP2800single_d3(state):#err0.21
	x0 = state[0]
	x1 = state[1]
	y = -0.419768136583192*(0.5 - 0.25*x0)*(0.5 - 0.25*x1)*(0.5*x0 + 1)**2*(0.5*x1 + 1)**2 + 0.0459447853749247*(0.5 - 0.25*x0)*(1 - 0.5*x1)**3*(0.5*x0 + 1)**2 - 0.237776506698047*(0.5 - 0.25*x0)*(1 - 0.5*x1)**2*(0.5*x0 + 1)**2*(0.25*x1 + 0.5) - 0.0866547277217476*(0.5 - 0.25*x0)*(0.5*x0 + 1)**2*(0.5*x1 + 1)**3 + 0.0764492989998112*(0.5 - 0.25*x1)*(1 - 0.5*x0)**3*(0.5*x1 + 1)**2 + 0.160313683321859*(0.5 - 0.25*x1)*(1 - 0.5*x0)**2*(0.25*x0 + 0.5)*(0.5*x1 + 1)**2 - 0.0734825864888631*(0.5 - 0.25*x1)*(0.5*x0 + 1)**3*(0.5*x1 + 1)**2 + 0.0153268478161364*(1 - 0.5*x0)**3*(1 - 0.5*x1)**3 + 0.0898873643016874*(1 - 0.5*x0)**3*(1 - 0.5*x1)**2*(0.25*x1 + 0.5) + 0.00432900786363051*(1 - 0.5*x0)**3*(0.5*x1 + 1)**3 + 0.0888183513303775*(1 - 0.5*x0)**2*(1 - 0.5*x1)**3*(0.25*x0 + 0.5) + 0.432223221099657*(1 - 0.5*x0)**2*(1 - 0.5*x1)**2*(0.25*x0 + 0.5)*(0.25*x1 + 0.5) - 0.0589070765710436*(1 - 0.5*x0)**2*(0.25*x0 + 0.5)*(0.5*x1 + 1)**3 - 0.00219764354323347*(1 - 0.5*x1)**3*(0.5*x0 + 1)**3 - 0.0418227260628735*(1 - 0.5*x1)**2*(0.5*x0 + 1)**3*(0.25*x1 + 0.5) - 0.0144794814867174*(0.5*x0 + 1)**3*(0.5*x1 + 1)**3
	return y	

def BP2800single_d7(state): # err0.15
	x0 = state[0]
	x1 = state[1]
	y = -0.0105078115320917*(0.5 - 0.25*x0)*(0.5 - 0.25*x1)*(0.5*x0 + 1)**6*(0.5*x1 + 1)**6 + 0.00013478448185721*(0.5 - 0.25*x0)*(1 - 0.5*x1)**7*(0.5*x0 + 1)**6 - 0.00204372015173224*(0.5 - 0.25*x0)*(1 - 0.5*x1)**6*(0.5*x0 + 1)**6*(0.25*x1 + 0.5) - 0.00606062802961467*(0.5 - 0.25*x0)*(1 - 0.5*x1)**5*(0.5*x0 + 1)**6*(0.5*x1 + 1)**2 - 0.0134356630315434*(0.5 - 0.25*x0)*(1 - 0.5*x1)**4*(0.5*x0 + 1)**6*(0.5*x1 + 1)**3 - 0.0186705570970677*(0.5 - 0.25*x0)*(1 - 0.5*x1)**3*(0.5*x0 + 1)**6*(0.5*x1 + 1)**4 - 0.0135150555540858*(0.5 - 0.25*x0)*(1 - 0.5*x1)**2*(0.5*x0 + 1)**6*(0.5*x1 + 1)**5 - 0.000812445707235529*(0.5 - 0.25*x0)*(0.5*x0 + 1)**6*(0.5*x1 + 1)**7 + 0.00048542294905562*(0.5 - 0.25*x1)*(1 - 0.5*x0)**7*(0.5*x1 + 1)**6 + 0.00464621490877114*(0.5 - 0.25*x1)*(1 - 0.5*x0)**6*(0.25*x0 + 0.5)*(0.5*x1 + 1)**6 - 0.00136262211691931*(0.5 - 0.25*x1)*(1 - 0.5*x0)**5*(0.5*x0 + 1)**2*(0.5*x1 + 1)**6 - 0.0189859200259241*(0.5 - 0.25*x1)*(1 - 0.5*x0)**4*(0.5*x0 + 1)**3*(0.5*x1 + 1)**6 - 0.0239960684012056*(0.5 - 0.25*x1)*(1 - 0.5*x0)**3*(0.5*x0 + 1)**4*(0.5*x1 + 1)**6 - 0.0160873735275024*(0.5 - 0.25*x1)*(1 - 0.5*x0)**2*(0.5*x0 + 1)**5*(0.5*x1 + 1)**6 - 0.000753940163867772*(0.5 - 0.25*x1)*(0.5*x0 + 1)**7*(0.5*x1 + 1)**6 + 5.9870499281783e-5*(1 - 0.5*x0)**7*(1 - 0.5*x1)**7 + 0.000840004417130521*(1 - 0.5*x0)**7*(1 - 0.5*x1)**6*(0.25*x1 + 0.5) + 0.00123939562007052*(1 - 0.5*x0)**7*(1 - 0.5*x1)**5*(0.5*x1 + 1)**2 + 0.00199977689132857*(1 - 0.5*x0)**7*(1 - 0.5*x1)**4*(0.5*x1 + 1)**3 + 0.00187619533843006*(1 - 0.5*x0)**7*(1 - 0.5*x1)**3*(0.5*x1 + 1)**4 + 0.000992247853580538*(1 - 0.5*x0)**7*(1 - 0.5*x1)**2*(0.5*x1 + 1)**5 + 1.69101869673067e-5*(1 - 0.5*x0)**7*(0.5*x1 + 1)**7 + 0.000844804841361804*(1 - 0.5*x0)**6*(1 - 0.5*x1)**7*(0.25*x0 + 0.5) + 0.0117084663537701*(1 - 0.5*x0)**6*(1 - 0.5*x1)**6*(0.25*x0 + 0.5)*(0.25*x1 + 0.5) + 0.0172012585532422*(1 - 0.5*x0)**6*(1 - 0.5*x1)**5*(0.25*x0 + 0.5)*(0.5*x1 + 1)**2 + 0.0272992741998547*(1 - 0.5*x0)**6*(1 - 0.5*x1)**4*(0.25*x0 + 0.5)*(0.5*x1 + 1)**3 + 0.0245392722808595*(1 - 0.5*x0)**6*(1 - 0.5*x1)**3*(0.25*x0 + 0.5)*(0.5*x1 + 1)**4 + 0.0116370568508696*(1 - 0.5*x0)**6*(1 - 0.5*x1)**2*(0.25*x0 + 0.5)*(0.5*x1 + 1)**5 + 9.15803904594068e-5*(1 - 0.5*x0)**6*(0.25*x0 + 0.5)*(0.5*x1 + 1)**7 + 0.00123612575188521*(1 - 0.5*x0)**5*(1 - 0.5*x1)**7*(0.5*x0 + 1)**2 + 0.0167094404160254*(1 - 0.5*x0)**5*(1 - 0.5*x1)**6*(0.5*x0 + 1)**2*(0.25*x1 + 0.5) + 0.0233900972762642*(1 - 0.5*x0)**5*(1 - 0.5*x1)**5*(0.5*x0 + 1)**2*(0.5*x1 + 1)**2 + 0.033988275126954*(1 - 0.5*x0)**5*(1 - 0.5*x1)**4*(0.5*x0 + 1)**2*(0.5*x1 + 1)**3 + 0.0257169218618783*(1 - 0.5*x0)**5*(1 - 0.5*x1)**3*(0.5*x0 + 1)**2*(0.5*x1 + 1)**4 + 0.0095142702430988*(1 - 0.5*x0)**5*(1 - 0.5*x1)**2*(0.5*x0 + 1)**2*(0.5*x1 + 1)**5 - 0.000565487949010307*(1 - 0.5*x0)**5*(0.5*x0 + 1)**2*(0.5*x1 + 1)**7 + 0.00189415923397352*(1 - 0.5*x0)**4*(1 - 0.5*x1)**7*(0.5*x0 + 1)**3 + 0.0235870237352869*(1 - 0.5*x0)**4*(1 - 0.5*x1)**6*(0.5*x0 + 1)**3*(0.25*x1 + 0.5) + 0.0279410700854362*(1 - 0.5*x0)**4*(1 - 0.5*x1)**5*(0.5*x0 + 1)**3*(0.5*x1 + 1)**2 + 0.0278527309339011*(1 - 0.5*x0)**4*(1 - 0.5*x1)**4*(0.5*x0 + 1)**3*(0.5*x1 + 1)**3 + 0.00735845962803789*(1 - 0.5*x0)**4*(1 - 0.5*x1)**3*(0.5*x0 + 1)**3*(0.5*x1 + 1)**4 - 0.0140978881398889*(1 - 0.5*x0)**4*(1 - 0.5*x1)**2*(0.5*x0 + 1)**3*(0.5*x1 + 1)**5 - 0.00165854981592961*(1 - 0.5*x0)**4*(0.5*x0 + 1)**3*(0.5*x1 + 1)**7 + 0.00142673173691292*(1 - 0.5*x0)**3*(1 - 0.5*x1)**7*(0.5*x0 + 1)**4 + 0.0130717826278993*(1 - 0.5*x0)**3*(1 - 0.5*x1)**6*(0.5*x0 + 1)**4*(0.25*x1 + 0.5) + 0.00581387646863504*(1 - 0.5*x0)**3*(1 - 0.5*x1)**5*(0.5*x0 + 1)**4*(0.5*x1 + 1)**2 - 0.0222055841682756*(1 - 0.5*x0)**3*(1 - 0.5*x1)**4*(0.5*x0 + 1)**4*(0.5*x1 + 1)**3 - 0.0371468016489081*(1 - 0.5*x0)**3*(1 - 0.5*x1)**3*(0.5*x0 + 1)**4*(0.5*x1 + 1)**4 - 0.0304090198925749*(1 - 0.5*x0)**3*(1 - 0.5*x1)**2*(0.5*x0 + 1)**4*(0.5*x1 + 1)**5 - 0.00188440055501374*(1 - 0.5*x0)**3*(0.5*x0 + 1)**4*(0.5*x1 + 1)**7 + 0.00048717352043014*(1 - 0.5*x0)**2*(1 - 0.5*x1)**7*(0.5*x0 + 1)**5 + 0.00234814343070158*(1 - 0.5*x0)**2*(1 - 0.5*x1)**6*(0.5*x0 + 1)**5*(0.25*x1 + 0.5) - 0.00609882461407609*(1 - 0.5*x0)**2*(1 - 0.5*x1)**5*(0.5*x0 + 1)**5*(0.5*x1 + 1)**2 - 0.0209467742594684*(1 - 0.5*x0)**2*(1 - 0.5*x1)**4*(0.5*x0 + 1)**5*(0.5*x1 + 1)**3 - 0.0320039701124652*(1 - 0.5*x0)**2*(1 - 0.5*x1)**3*(0.5*x0 + 1)**5*(0.5*x1 + 1)**4 - 0.0222220420173621*(1 - 0.5*x0)**2*(1 - 0.5*x1)**2*(0.5*x0 + 1)**5*(0.5*x1 + 1)**5 - 0.00120426068777162*(1 - 0.5*x0)**2*(0.5*x0 + 1)**5*(0.5*x1 + 1)**7 - 8.58454509075574e-6*(1 - 0.5*x1)**7*(0.5*x0 + 1)**7 - 0.000321295949763133*(1 - 0.5*x1)**6*(0.5*x0 + 1)**7*(0.25*x1 + 0.5) - 0.000512952152721354*(1 - 0.5*x1)**5*(0.5*x0 + 1)**7*(0.5*x1 + 1)**2 - 0.0012088703906489*(1 - 0.5*x1)**4*(0.5*x0 + 1)**7*(0.5*x1 + 1)**3 - 0.00151937740185315*(1 - 0.5*x1)**3*(0.5*x0 + 1)**7*(0.5*x1 + 1)**4 - 0.00104297154579598*(1 - 0.5*x1)**2*(0.5*x0 + 1)**7*(0.5*x1 + 1)**5 - 5.65604745574897e-5*(0.5*x0 + 1)**7*(0.5*x1 + 1)**7
	return y	

def bp_2900(state):
	x0 = state[0]
	x1 = state[1]
	if x0 <= -1: #[5, 5] err 0.05
		y = 0.0431058266625761*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)**5*(0.5*x1 + 1)**4 + 0.124696357584276*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0)*(0.5*x1 + 1)**4 + 0.762074033039328*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2*(0.5*x1 + 1)**4 + 1.06169380168497*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3*(0.5*x1 + 1)**4 + 0.51068072869508*(0.5 - 0.25*x1)*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4*(0.5*x1 + 1)**4 - 0.0163316642724071*(0.5 - 0.25*x1)*(0.5*x0 + 1)**5*(0.5*x1 + 1)**4 + 0.0299212072417865*(1 - 0.5*x1)**5*(-1.0*x0 - 1.0)**5 + 0.153118305390411*(1 - 0.5*x1)**5*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0) + 1.2153443613862*(1 - 0.5*x1)**5*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2 + 2.40426667945128*(1 - 0.5*x1)**5*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3 + 2.36804189162991*(1 - 0.5*x1)**5*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4 + 0.927446746619732*(1 - 0.5*x1)**5*(0.5*x0 + 1)**5 + 0.297113808165431*(1 - 0.5*x1)**4*(-1.0*x0 - 1.0)**5*(0.25*x1 + 0.5) + 1.48049882766345*(1 - 0.5*x1)**4*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0)*(0.25*x1 + 0.5) + 11.8008323047646*(1 - 0.5*x1)**4*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2*(0.25*x1 + 0.5) + 23.2823345811591*(1 - 0.5*x1)**4*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3*(0.25*x1 + 0.5) + 22.6461909553983*(1 - 0.5*x1)**4*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4*(0.25*x1 + 0.5) + 8.71604486845753*(1 - 0.5*x1)**4*(0.5*x0 + 1)**5*(0.25*x1 + 0.5) + 0.268907557242801*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)**5*(0.5*x1 + 1)**2 + 1.33087907155879*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0)*(0.5*x1 + 1)**2 + 10.5314950065414*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2*(0.5*x1 + 1)**2 + 20.8188080353568*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3*(0.5*x1 + 1)**2 + 20.5609408414046*(1 - 0.5*x1)**3*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4*(0.5*x1 + 1)**2 + 7.77738194051437*(1 - 0.5*x1)**3*(0.5*x0 + 1)**5*(0.5*x1 + 1)**2 + 0.198649989359602*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)**5*(0.5*x1 + 1)**3 + 0.962123964478661*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0)*(0.5*x1 + 1)**3 + 7.4377394556472*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2*(0.5*x1 + 1)**3 + 14.336375433931*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3*(0.5*x1 + 1)**3 + 13.7766456866811*(1 - 0.5*x1)**2*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4*(0.5*x1 + 1)**3 + 5.27854079035844*(1 - 0.5*x1)**2*(0.5*x0 + 1)**5*(0.5*x1 + 1)**3 - 0.0132966934573948*(-1.0*x0 - 1.0)**5*(0.5*x1 + 1)**5 - 0.069280009133521*(-1.0*x0 - 1.0)**4*(1.0*x0 + 2.0)*(0.5*x1 + 1)**5 - 0.576178995977436*(-1.0*x0 - 1.0)**3*(0.5*x0 + 1)**2*(0.5*x1 + 1)**5 - 1.19535249797875*(-1.0*x0 - 1.0)**2*(0.5*x0 + 1)**3*(0.5*x1 + 1)**5 - 1.17083785303921*(-1.0*x0 - 1.0)*(0.5*x0 + 1)**4*(0.5*x1 + 1)**5 - 0.551452516523268*(0.5*x0 + 1)**5*(0.5*x1 + 1)**5
	
	elif -1 < x0 and x0 <= 0: #[5, 5] err 0.045
		y = 0.000510364508512723*x0**5*(0.5 - 0.25*x1)*(0.5*x1 + 1)**4 - 0.0289827108318666*x0**5*(1 - 0.5*x1)**5 - 0.272376402139298*x0**5*(1 - 0.5*x1)**4*(0.25*x1 + 0.5) - 0.243043185641074*x0**5*(1 - 0.5*x1)**3*(0.5*x1 + 1)**2 - 0.164954399698701*x0**5*(1 - 0.5*x1)**2*(0.5*x1 + 1)**3 + 0.0172328911413521*x0**5*(0.5*x1 + 1)**5 - 0.0242717009012183*x0**4*(0.5 - 0.25*x1)*(1.0*x0 + 1.0)*(0.5*x1 + 1)**4 + 0.140726511152363*x0**4*(1 - 0.5*x1)**5*(1.0*x0 + 1.0) + 1.29069356472398*x0**4*(1 - 0.5*x1)**4*(1.0*x0 + 1.0)*(0.25*x1 + 0.5) + 1.10021078439812*x0**4*(1 - 0.5*x1)**3*(1.0*x0 + 1.0)*(0.5*x1 + 1)**2 + 0.787228287383116*x0**4*(1 - 0.5*x1)**2*(1.0*x0 + 1.0)*(0.5*x1 + 1)**3 - 0.0921838852656296*x0**4*(1.0*x0 + 1.0)*(0.5*x1 + 1)**5 + 0.3145194767366*x0**3*(0.5 - 0.25*x1)*(1.0*x0 + 1.0)**2*(0.5*x1 + 1)**4 - 0.270203213272354*x0**3*(1 - 0.5*x1)**5*(1.0*x0 + 1.0)**2 - 2.39479592849482*x0**3*(1 - 0.5*x1)**4*(1.0*x0 + 1.0)**2*(0.25*x1 + 0.5) - 1.91088843833345*x0**3*(1 - 0.5*x1)**3*(1.0*x0 + 1.0)**2*(0.5*x1 + 1)**2 - 1.1674485360598*x0**3*(1 - 0.5*x1)**2*(1.0*x0 + 1.0)**2*(0.5*x1 + 1)**3 + 0.184925988181125*x0**3*(1.0*x0 + 1.0)**2*(0.5*x1 + 1)**5 - 0.490147010013756*x0**2*(0.5 - 0.25*x1)*(1.0*x0 + 1.0)**3*(0.5*x1 + 1)**4 + 0.25526983392568*x0**2*(1 - 0.5*x1)**5*(1.0*x0 + 1.0)**3 + 2.15504500847543*x0**2*(1 - 0.5*x1)**4*(1.0*x0 + 1.0)**3*(0.25*x1 + 0.5) + 1.55737706830821*x0**2*(1 - 0.5*x1)**3*(1.0*x0 + 1.0)**3*(0.5*x1 + 1)**2 + 0.719566052075315*x0**2*(1 - 0.5*x1)**2*(1.0*x0 + 1.0)**3*(0.5*x1 + 1)**3 - 0.178516859983987*x0**2*(1.0*x0 + 1.0)**3*(0.5*x1 + 1)**5 + 0.465556658526828*x0*(0.5 - 0.25*x1)*(1.0*x0 + 1.0)**4*(0.5*x1 + 1)**4 - 0.117879210398876*x0*(1 - 0.5*x1)**5*(1.0*x0 + 1.0)**4 - 0.927345841664076*x0*(1 - 0.5*x1)**4*(1.0*x0 + 1.0)**4*(0.25*x1 + 0.5) - 0.570738311282619*x0*(1 - 0.5*x1)**3*(1.0*x0 + 1.0)**4*(0.5*x1 + 1)**2 - 0.0903067823134836*x0*(1 - 0.5*x1)**2*(1.0*x0 + 1.0)**4*(0.5*x1 + 1)**3 + 0.0904174719403731*x0*(1.0*x0 + 1.0)**4*(0.5*x1 + 1)**5 - 0.133309464034061*(0.5 - 0.25*x1)*(1.0*x0 + 1.0)**5*(0.5*x1 + 1)**4 + 0.021078667992685*(1 - 0.5*x1)**5*(1.0*x0 + 1.0)**5 + 0.149012963668731*(1 - 0.5*x1)**4*(1.0*x0 + 1.0)**5*(0.25*x1 + 0.5) + 0.0673016547590529*(1 - 0.5*x1)**3*(1.0*x0 + 1.0)**5*(0.5*x1 + 1)**2 - 0.0476990632460955*(1 - 0.5*x1)**2*(1.0*x0 + 1.0)**5*(0.5*x1 + 1)**3 - 0.0186406982956862*(1.0*x0 + 1.0)**5*(0.5*x1 + 1)**5
	
	elif 0 < x0 and x0 <= 1:#[7, 7] err 0.1
		y = -0.0799695397322273*x0**7*(0.5 - 0.25*x1)*(0.5*x1 + 1)**6 + 0.00128135490525346*x0**7*(1 - 0.5*x1)**7 - 0.013227196403628*x0**7*(1 - 0.5*x1)**6*(0.25*x1 + 0.5) - 0.0438232254710102*x0**7*(1 - 0.5*x1)**5*(0.5*x1 + 1)**2 - 0.0884183269192928*x0**7*(1 - 0.5*x1)**4*(0.5*x1 + 1)**3 - 0.144670361117989*x0**7*(1 - 0.5*x1)**3*(0.5*x1 + 1)**4 - 0.10608441146292*x0**7*(1 - 0.5*x1)**2*(0.5*x1 + 1)**5 - 0.00623396718515884*x0**7*(0.5*x1 + 1)**7 - 0.539916135955936*x0**6*(0.5 - 0.25*x1)*(1 - 1.0*x0)*(0.5*x1 + 1)**6 + 0.0169701119562911*x0**6*(1 - 1.0*x0)*(1 - 0.5*x1)**7 + 0.0147994310872508*x0**6*(1 - 1.0*x0)*(1 - 0.5*x1)**6*(0.25*x1 + 0.5) - 0.278549116829259*x0**6*(1 - 1.0*x0)*(1 - 0.5*x1)**5*(0.5*x1 + 1)**2 - 0.728330964119922*x0**6*(1 - 1.0*x0)*(1 - 0.5*x1)**4*(0.5*x1 + 1)**3 - 0.963862695407172*x0**6*(1 - 1.0*x0)*(1 - 0.5*x1)**3*(0.5*x1 + 1)**4 - 0.705500507090039*x0**6*(1 - 1.0*x0)*(1 - 0.5*x1)**2*(0.5*x1 + 1)**5 - 0.0425257809871201*x0**6*(1 - 1.0*x0)*(0.5*x1 + 1)**7 - 1.55545485842083*x0**5*(0.5 - 0.25*x1)*(1 - 1.0*x0)**2*(0.5*x1 + 1)**6 + 0.0724876770164992*x0**5*(1 - 1.0*x0)**2*(1 - 0.5*x1)**7 + 0.253242759369438*x0**5*(1 - 1.0*x0)**2*(1 - 0.5*x1)**6*(0.25*x1 + 0.5) - 0.91507247293607*x0**5*(1 - 1.0*x0)**2*(1 - 0.5*x1)**5*(0.5*x1 + 1)**2 - 2.04961100295469*x0**5*(1 - 1.0*x0)**2*(1 - 0.5*x1)**4*(0.5*x1 + 1)**3 - 2.65557618783462*x0**5*(1 - 1.0*x0)**2*(1 - 0.5*x1)**3*(0.5*x1 + 1)**4 - 1.99765626363572*x0**5*(1 - 1.0*x0)**2*(1 - 0.5*x1)**2*(0.5*x1 + 1)**5 - 0.123951310938833*x0**5*(1 - 1.0*x0)**2*(0.5*x1 + 1)**7 - 2.47719997521566*x0**4*(0.5 - 0.25*x1)*(1 - 1.0*x0)**3*(0.5*x1 + 1)**6 + 0.128206649244392*x0**4*(1 - 1.0*x0)**3*(1 - 0.5*x1)**7 + 1.01080647671854*x0**4*(1 - 1.0*x0)**3*(1 - 0.5*x1)**6*(0.25*x1 + 0.5) - 0.821458680185508*x0**4*(1 - 1.0*x0)**3*(1 - 0.5*x1)**5*(0.5*x1 + 1)**2 - 3.20399142945905*x0**4*(1 - 1.0*x0)**3*(1 - 0.5*x1)**4*(0.5*x1 + 1)**3 - 4.01261835668922*x0**4*(1 - 1.0*x0)**3*(1 - 0.5*x1)**3*(0.5*x1 + 1)**4 - 3.11865019575421*x0**4*(1 - 1.0*x0)**3*(1 - 0.5*x1)**2*(0.5*x1 + 1)**5 - 0.20003222126338*x0**4*(1 - 1.0*x0)**3*(0.5*x1 + 1)**7 - 2.35369821592098*x0**3*(0.5 - 0.25*x1)*(1 - 1.0*x0)**4*(0.5*x1 + 1)**6 + 0.137711392584296*x0**3*(1 - 1.0*x0)**4*(1 - 0.5*x1)**7 + 1.26645397973822*x0**3*(1 - 1.0*x0)**4*(1 - 0.5*x1)**6*(0.25*x1 + 0.5) + 0.480539826105664*x0**3*(1 - 1.0*x0)**4*(1 - 0.5*x1)**5*(0.5*x1 + 1)**2 - 2.70130112236518*x0**3*(1 - 1.0*x0)**4*(1 - 0.5*x1)**4*(0.5*x1 + 1)**3 - 3.58027855128909*x0**3*(1 - 1.0*x0)**4*(1 - 0.5*x1)**3*(0.5*x1 + 1)**4 - 2.89523863252263*x0**3*(1 - 1.0*x0)**4*(1 - 0.5*x1)**2*(0.5*x1 + 1)**5 - 0.192944246083064*x0**3*(1 - 1.0*x0)**4*(0.5*x1 + 1)**7 - 1.33306937093007*x0**2*(0.5 - 0.25*x1)*(1 - 1.0*x0)**5*(0.5*x1 + 1)**6 + 0.090791480132767*x0**2*(1 - 1.0*x0)**5*(1 - 0.5*x1)**7 + 0.897850878199017*x0**2*(1 - 1.0*x0)**5*(1 - 0.5*x1)**6*(0.25*x1 + 0.5) + 0.688172740759813*x0**2*(1 - 1.0*x0)**5*(1 - 0.5*x1)**5*(0.5*x1 + 1)**2 - 0.930363166455803*x0**2*(1 - 1.0*x0)**5*(1 - 0.5*x1)**4*(0.5*x1 + 1)**3 - 1.8781515133455*x0**2*(1 - 1.0*x0)**5*(1 - 0.5*x1)**3*(0.5*x1 + 1)**4 - 1.59565263496549*x0**2*(1 - 1.0*x0)**5*(1 - 0.5*x1)**2*(0.5*x1 + 1)**5 - 0.111179559327791*x0**2*(1 - 1.0*x0)**5*(0.5*x1 + 1)**7 - 0.416279760551046*x0*(0.5 - 0.25*x1)*(1 - 1.0*x0)**6*(0.5*x1 + 1)**6 + 0.0331111516019564*x0*(1 - 1.0*x0)**6*(1 - 0.5*x1)**7 + 0.34615873801931*x0*(1 - 1.0*x0)**6*(1 - 0.5*x1)**6*(0.25*x1 + 0.5) + 0.305974561443368*x0*(1 - 1.0*x0)**6*(1 - 0.5*x1)**5*(0.5*x1 + 1)**2 + 0.116934511237023*x0*(1 - 1.0*x0)**6*(1 - 0.5*x1)**4*(0.5*x1 + 1)**3 - 0.483733886941566*x0*(1 - 1.0*x0)**6*(1 - 0.5*x1)**3*(0.5*x1 + 1)**4 - 0.482320458363291*x0*(1 - 1.0*x0)**6*(1 - 0.5*x1)**2*(0.5*x1 + 1)**5 - 0.0354156417918178*x0*(1 - 1.0*x0)**6*(0.5*x1 + 1)**7 - 0.0524171660544613*(0.5 - 0.25*x1)*(1 - 1.0*x0)**7*(0.5*x1 + 1)**6 + 0.00526966699817124*(1 - 1.0*x0)**7*(1 - 0.5*x1)**7 + 0.0590992729401111*(1 - 1.0*x0)**7*(1 - 0.5*x1)**6*(0.25*x1 + 0.5) + 0.0609651874506684*(1 - 1.0*x0)**7*(1 - 0.5*x1)**5*(0.5*x1 + 1)**2 + 0.0476129086163586*(1 - 1.0*x0)**7*(1 - 0.5*x1)**4*(0.5*x1 + 1)**3 - 0.0253925193923594*(1 - 1.0*x0)**7*(1 - 0.5*x1)**3*(0.5*x1 + 1)**4 - 0.0561015156273926*(1 - 1.0*x0)**7*(1 - 0.5*x1)**2*(0.5*x1 + 1)**5 - 0.00466017457392156*(1 - 1.0*x0)**7*(0.5*x1 + 1)**7

	elif 1 < x0: #[5, 5] err 0.073
		y = -6.99589733125163*(0.5 - 0.25*x1)*(1 - 0.5*x0)**5*(0.5*x1 + 1)**4 - 18.3986746600673*(0.5 - 0.25*x1)*(1 - 0.5*x0)**4*(1.0*x0 - 1.0)*(0.5*x1 + 1)**4 - 16.7611088679586*(0.5 - 0.25*x1)*(1 - 0.5*x0)**3*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**4 - 8.55704763468032*(0.5 - 0.25*x1)*(1 - 0.5*x0)**2*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**4 - 1.09091817494521*(0.5 - 0.25*x1)*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4*(0.5*x1 + 1)**4 - 0.222288709141128*(0.5 - 0.25*x1)*(1.0*x0 - 1.0)**5*(0.5*x1 + 1)**4 + 0.164013427872442*(1 - 0.5*x0)**5*(1 - 0.5*x1)**5 - 1.80421616496914*(1 - 0.5*x0)**5*(1 - 0.5*x1)**4*(0.25*x1 + 0.5) - 3.10057001946646*(1 - 0.5*x0)**5*(1 - 0.5*x1)**3*(0.5*x1 + 1)**2 - 5.64937354854768*(1 - 0.5*x0)**5*(1 - 0.5*x1)**2*(0.5*x1 + 1)**3 - 0.797947799700332*(1 - 0.5*x0)**5*(0.5*x1 + 1)**5 + 0.204741717226228*(1 - 0.5*x0)**4*(1 - 0.5*x1)**5*(1.0*x0 - 1.0) - 5.39395972433865*(1 - 0.5*x0)**4*(1 - 0.5*x1)**4*(1.0*x0 - 1.0)*(0.25*x1 + 0.5) - 7.93187383136894*(1 - 0.5*x0)**4*(1 - 0.5*x1)**3*(1.0*x0 - 1.0)*(0.5*x1 + 1)**2 - 12.5815142648579*(1 - 0.5*x0)**4*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)*(0.5*x1 + 1)**3 - 2.05909118467115*(1 - 0.5*x0)**4*(1.0*x0 - 1.0)*(0.5*x1 + 1)**5 - 0.107122331128754*(1 - 0.5*x0)**3*(1 - 0.5*x1)**5*(1.0*x0 - 1.0)**2 - 6.26347299150158*(1 - 0.5*x0)**3*(1 - 0.5*x1)**4*(1.0*x0 - 1.0)**2*(0.25*x1 + 0.5) - 8.3646182854216*(1 - 0.5*x0)**3*(1 - 0.5*x1)**3*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**2 - 13.0623827890213*(1 - 0.5*x0)**3*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**3 - 2.10887632323091*(1 - 0.5*x0)**3*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**5 - 0.0993646946446728*(1 - 0.5*x0)**2*(1 - 0.5*x1)**5*(1.0*x0 - 1.0)**3 - 3.56630519606861*(1 - 0.5*x0)**2*(1 - 0.5*x1)**4*(1.0*x0 - 1.0)**3*(0.25*x1 + 0.5) - 4.46949525243942*(1 - 0.5*x0)**2*(1 - 0.5*x1)**3*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**2 - 6.76515695574362*(1 - 0.5*x0)**2*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**3 - 0.986561110997893*(1 - 0.5*x0)**2*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**5 - 0.0181126573458919*(1 - 0.5*x1)**5*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4 - 0.00557535923614088*(1 - 0.5*x1)**5*(1.0*x0 - 1.0)**5 - 0.501975998443453*(1 - 0.5*x1)**4*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4*(0.25*x1 + 0.5) - 0.105037355571941*(1 - 0.5*x1)**4*(1.0*x0 - 1.0)**5*(0.25*x1 + 0.5) - 0.59392141444064*(1 - 0.5*x1)**3*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4*(0.5*x1 + 1)**2 - 0.125692751200488*(1 - 0.5*x1)**3*(1.0*x0 - 1.0)**5*(0.5*x1 + 1)**2 - 0.874075687445844*(1 - 0.5*x1)**2*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4*(0.5*x1 + 1)**3 - 0.180337715423*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)**5*(0.5*x1 + 1)**3 - 0.124826733852978*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**4*(0.5*x1 + 1)**5 - 0.0252543581800987*(1.0*x0 - 1.0)**5*(0.5*x1 + 1)**5

	return y

def BP_2900new(state):
	x0 = state[0]
	x1 = state[1]
	if x0 <= 0: # [3,3] err 0.08
		y = -0.048275406748866*x0**3*(0.5 - 0.25*x1)*(0.5*x1 + 1)**2 - 0.0149606036208933*x0**3*(1 - 0.5*x1)**3 - 0.0844553465641921*x0**3*(1 - 0.5*x1)**2*(0.25*x1 + 0.5) + 0.00664834672869741*x0**3*(0.5*x1 + 1)**3 + 0.241975372057968*x0**2*(0.5 - 0.25*x1)*(0.5*x0 + 1.0)*(0.5*x1 + 1)**2 + 0.0897536396865137*x0**2*(1 - 0.5*x1)**3*(0.5*x0 + 1.0) + 0.493955871013361*x0**2*(1 - 0.5*x1)**2*(0.5*x0 + 1.0)*(0.25*x1 + 0.5) - 0.0443348801347037*x0**2*(0.5*x0 + 1.0)*(0.5*x1 + 1)**3 - 0.360742990279787*x0*(0.5 - 0.25*x1)*(0.5*x0 + 1.0)**2*(0.5*x1 + 1)**2 - 0.164592097284787*x0*(1 - 0.5*x1)**3*(0.5*x0 + 1.0)**2 - 0.786777932378691*x0*(1 - 0.5*x1)**2*(0.5*x0 + 1.0)**2*(0.25*x1 + 0.5) + 0.113822631870465*x0*(0.5*x0 + 1.0)**2*(0.5*x1 + 1)**3 - 0.20640703464243*(0.5 - 0.25*x1)*(0.5*x0 + 1.0)**3*(0.5*x1 + 1)**2 + 0.0843146719707399*(1 - 0.5*x1)**3*(0.5*x0 + 1.0)**3 + 0.231331921694404*(1 - 0.5*x1)**2*(0.5*x0 + 1.0)**3*(0.25*x1 + 0.5) - 0.0745627931827449*(0.5*x0 + 1.0)**3*(0.5*x1 + 1)**3
	
	elif 0 < x0 and x0 < 1:#[5, 5] err 0.1
 		y = -0.218621791601614*x0**5*(0.5 - 0.25*x1)*(0.5*x1 + 1)**4 + 0.00512541962101383*x0**5*(1 - 0.5*x1)**5 - 0.0563817551552856*x0**5*(1 - 0.5*x1)**4*(0.25*x1 + 0.5) - 0.096892813108327*x0**5*(1 - 0.5*x1)**3*(0.5*x1 + 1)**2 - 0.176542923392115*x0**5*(1 - 0.5*x1)**2*(0.5*x1 + 1)**3 - 0.0249358687406354*x0**5*(0.5*x1 + 1)**5 - 1.03001441639493*x0**4*(0.5 - 0.25*x1)*(1 - 1.0*x0)*(0.5*x1 + 1)**4 + 0.0592018540195095*x0**4*(1 - 1.0*x0)*(1 - 0.5*x1)**5 - 0.183730918060303*x0**4*(1 - 1.0*x0)*(1 - 0.5*x1)**4*(0.25*x1 + 0.5) - 0.597961036702813*x0**4*(1 - 1.0*x0)*(1 - 0.5*x1)**3*(0.5*x1 + 1)**2 - 0.799465213263373*x0**4*(1 - 1.0*x0)*(1 - 0.5*x1)**2*(0.5*x1 + 1)**3 - 0.120154900291834*x0**4*(1 - 1.0*x0)*(0.5*x1 + 1)**5 - 1.92072369588131*x0**3*(0.5 - 0.25*x1)*(1 - 1.0*x0)**2*(0.5*x1 + 1)**4 + 0.144852927346386*x0**3*(1 - 1.0*x0)**2*(1 - 0.5*x1)**5 + 0.202933590099397*x0**3*(1 - 1.0*x0)**2*(1 - 0.5*x1)**4*(0.25*x1 + 0.5) - 1.03242713886023*x0**3*(1 - 1.0*x0)**2*(1 - 0.5*x1)**3*(0.5*x1 + 1)**2 - 1.41915382173523*x0**3*(1 - 1.0*x0)**2*(1 - 0.5*x1)**2*(0.5*x1 + 1)**3 - 0.230154162929677*x0**3*(1 - 1.0*x0)**2*(0.5*x1 + 1)**5 - 1.76796563960617*x0**2*(0.5 - 0.25*x1)*(1 - 1.0*x0)**3*(0.5*x1 + 1)**4 + 0.160585503431679*x0**2*(1 - 1.0*x0)**3*(1 - 0.5*x1)**5 + 0.833762436406734*x0**2*(1 - 1.0*x0)**3*(1 - 0.5*x1)**4*(0.25*x1 + 0.5) - 0.653443551938321*x0**2*(1 - 1.0*x0)**3*(1 - 0.5*x1)**3*(0.5*x1 + 1)**2 - 1.22670929701908*x0**2*(1 - 1.0*x0)**3*(1 - 0.5*x1)**2*(0.5*x1 + 1)**3 - 0.218811969098373*x0**2*(1 - 1.0*x0)**3*(0.5*x1 + 1)**5 - 0.800840348268054*x0*(0.5 - 0.25*x1)*(1 - 1.0*x0)**4*(0.5*x1 + 1)**4 + 0.0908593180576553*x0*(1 - 1.0*x0)**4*(1 - 0.5*x1)**5 + 0.553338991442978*x0*(1 - 1.0*x0)**4*(1 - 0.5*x1)**4*(0.25*x1 + 0.5) + 0.117910714305773*x0*(1 - 1.0*x0)**4*(1 - 0.5*x1)**3*(0.5*x1 + 1)**2 - 0.511299414040565*x0*(1 - 1.0*x0)**4*(1 - 0.5*x1)**2*(0.5*x1 + 1)**3 - 0.103106754193832*x0*(1 - 1.0*x0)**4*(0.5*x1 + 1)**5 - 0.133309464034061*(0.5 - 0.25*x1)*(1 - 1.0*x0)**5*(0.5*x1 + 1)**4 + 0.021078667992685*(1 - 1.0*x0)**5*(1 - 0.5*x1)**5 + 0.149012963668731*(1 - 1.0*x0)**5*(1 - 0.5*x1)**4*(0.25*x1 + 0.5) + 0.0673016547590529*(1 - 1.0*x0)**5*(1 - 0.5*x1)**3*(0.5*x1 + 1)**2 - 0.0476990632460955*(1 - 1.0*x0)**5*(1 - 0.5*x1)**2*(0.5*x1 + 1)**3 - 0.0186406982956862*(1 - 1.0*x0)**5*(0.5*x1 + 1)**5

	elif 1 < x0: #[3, 3] err 0.073
		y = -3.68481896205469*(0.5 - 0.25*x1)*(1 - 0.5*x0)**3*(0.5*x1 + 1)**2 - 5.13487949238855*(0.5 - 0.25*x1)*(1 - 0.5*x0)**2*(1.0*x0 - 1.0)*(0.5*x1 + 1)**2 - 1.34810340083204*(0.5 - 0.25*x1)*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**2 - 0.469739244931289*(0.5 - 0.25*x1)*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**2 + 0.164013427872442*(1 - 0.5*x0)**3*(1 - 0.5*x1)**3 - 1.89277714807773*(1 - 0.5*x0)**3*(1 - 0.5*x1)**2*(0.25*x1 + 0.5) - 0.797947799700332*(1 - 0.5*x0)**3*(0.5*x1 + 1)**3 - 0.022409019543412*(1 - 0.5*x0)**2*(1 - 0.5*x1)**3*(1.0*x0 - 1.0) - 2.86918911437958*(1 - 0.5*x0)**2*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)*(0.25*x1 + 0.5) - 1.2586282964988*(1 - 0.5*x0)**2*(1.0*x0 - 1.0)*(0.5*x1 + 1)**3 - 0.0343737561491096*(1 - 0.5*x1)**3*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**2 - 0.0223014369445635*(1 - 0.5*x1)**3*(1.0*x0 - 1.0)**3 - 0.681702341720389*(1 - 0.5*x1)**2*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**2*(0.25*x1 + 0.5) - 0.251635916467943*(1 - 0.5*x1)**2*(1.0*x0 - 1.0)**3*(0.25*x1 + 0.5) - 0.297190291426676*(2.0 - 1.0*x0)*(1.0*x0 - 1.0)**2*(0.5*x1 + 1)**3 - 0.101017432720395*(1.0*x0 - 1.0)**3*(0.5*x1 + 1)**3
	
	return y

def BP2900single_d3(state):
	x0 = state[0]
	x1 = state[1]
	y = -0.298227270819613*(0.5 - 0.25*x0)*(0.5 - 0.25*x1)*(0.5*x0 + 1)**2*(0.5*x1 + 1)**2 + 0.0422752810244108*(0.5 - 0.25*x0)*(1 - 0.5*x1)**3*(0.5*x0 + 1)**2 - 0.164466419583619*(0.5 - 0.25*x0)*(1 - 0.5*x1)**2*(0.5*x0 + 1)**2*(0.25*x1 + 0.5) - 0.070100231134459*(0.5 - 0.25*x0)*(0.5*x0 + 1)**2*(0.5*x1 + 1)**3 + 0.048275406748866*(0.5 - 0.25*x1)*(1 - 0.5*x0)**3*(0.5*x1 + 1)**2 + 0.180371495139893*(0.5 - 0.25*x1)*(1 - 0.5*x0)**2*(0.25*x0 + 0.5)*(0.5*x1 + 1)**2 - 0.0587174056164112*(0.5 - 0.25*x1)*(0.5*x0 + 1)**3*(0.5*x1 + 1)**2 + 0.0149606036208933*(1 - 0.5*x0)**3*(1 - 0.5*x1)**3 + 0.0844553465641921*(1 - 0.5*x0)**3*(1 - 0.5*x1)**2*(0.25*x1 + 0.5) - 0.00664834672869741*(1 - 0.5*x0)**3*(0.5*x1 + 1)**3 + 0.0822960486423935*(1 - 0.5*x0)**2*(1 - 0.5*x1)**3*(0.25*x0 + 0.5) + 0.393388966189346*(1 - 0.5*x0)**2*(1 - 0.5*x1)**2*(0.25*x0 + 0.5)*(0.25*x1 + 0.5) - 0.0569113159352325*(1 - 0.5*x0)**2*(0.25*x0 + 0.5)*(0.5*x1 + 1)**3 - 0.00278767961807044*(1 - 0.5*x1)**3*(0.5*x0 + 1)**3 - 0.0314544895584929*(1 - 0.5*x1)**2*(0.5*x0 + 1)**3*(0.25*x1 + 0.5) - 0.0126271790900494*(0.5*x0 + 1)**3*(0.5*x1 + 1)**3
	return y

s_list, f_m1 =  model_test(agent, 'actor_2800.pth', state_list=None, renew=True, fig=1)
# _, f_m2 = model_test(agent, 'actor_2900.pth', state_list=s_list, renew=False, fig=2)
# print(np.mean(f_m1), np.mean(f_m2), len(f_m1), len(f_m2))

